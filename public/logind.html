<!DOCTYPE html>
<html lang="en">
<head>
  <title>Rare Explorer ‚Äì Travel Booking</title>
  <style>
    body {
      margin: 0;
      font-family: "Segoe UI", Arial, sans-serif;
      background: url("https://images.unsplash.com/photo-1507525428034-b723cf961d3e?auto=format&fit=crop&w=1600&q=80") no-repeat center center fixed;
      background-size: cover;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      color: #fff;
    }

    .overlay {
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(15, 23, 42, 0.75);
      z-index: 1;
    }

    .login-container {
      position: relative;
      z-index: 2;
      background: rgba(30, 41, 59, 0.9);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.7);
      width: 100%;
      max-width: 400px;
      text-align: center;
      overflow: hidden;
    }

    .logo {
      font-size: 32px;
      font-weight: bold;
      margin-bottom: 15px;
      background: linear-gradient(to right, #06b6d4, #490bf5);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .tagline {
      font-size: 14px;
      margin-bottom: 25px;
      color: #fff;
      font-style: italic;
    }

    .login-container h2 {
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: bold;
      transition: opacity 0.4s, transform 0.4s;
    }

    .input-group {
      margin-bottom: 18px;
      text-align: left;
      position: relative;
    }

    .input-group label {
      display: block;
      margin-bottom: 6px;
      font-size: 14px;
      font-weight: bold;
      color: #cbd5e1;
    }

    .input-group input {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      background: #0f172a;
      color: white;
      outline: none;
    }

    .toggle-password {
      position: absolute;
      right: 12px;
      top: 38px;
      cursor: pointer;
      font-size: 14px;
      color: #38bdf8;
      user-select: none;
    }

    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
      transition: 0.3s;
      background: linear-gradient(to right, #06b6d4, #490bf5);
      color: white;
      box-shadow: 0 4px 15px rgba(6, 182, 212, 0.4);
    }

    .btn:hover { transform: scale(1.03); opacity: 0.95; }

    .extra-links {
      text-align: center;
      margin-top: 15px;
      font-size: 14px;
    }

    .extra-links a {
      color: #38bdf8;
      text-decoration: none;
      cursor: pointer;
    }

    .extra-links a:hover { text-decoration: underline; }

    #message {
      margin-top: 15px;
      font-size: 14px;
      color: #f87171;
      min-height: 20px;
    }

    .fade { opacity: 0; transform: translateY(-10px); pointer-events: none; transition: opacity 0.4s, transform 0.4s; }
    .fade.show { opacity: 1; transform: translateY(0); pointer-events: all; }

    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      z-index: 999;
      align-items: center;
      justify-content: center;
    }

    .modal-content {
      background: #1e293b;
      padding: 25px;
      border-radius: 15px;
      width: 90%;
      max-width: 350px;
      text-align: center;
      color: white;
      box-shadow: 0 6px 20px rgba(0,0,0,0.6);
    }

    .modal-content h3 { margin-bottom: 10px; }

    .modal-content input {
      width: 100%;
      padding: 10px;
      margin: 12px 0;
      border: none;
      border-radius: 8px;
      background: #0f172a;
      color: white;
    }

    .btn.secondary {
      background: #64748b;
      margin-top: 8px;
    }
    .btn.secondary:hover { opacity: 0.9; }

  </style>
</head>
<body>
  <div class="overlay"></div>

  <div class="login-container">
    <div class="logo">Rare Explorer</div>
    <p class="tagline">Your journey begins here ‚úàÔ∏è</p>
    <h2 id="form-title" class="fade show">Login</h2>
    <form id="auth-form" class="fade show">
      <div class="input-group">
        <label for="email">Email</label>
        <input type="email" id="email" placeholder="Enter your email" required>
      </div>
      <div class="input-group">
        <label for="password">Password</label>
        <input type="password" id="password" placeholder="Enter your password" required>
        <span class="toggle-password" data-target="password">Show</span>
      </div>
      <div class="input-group" id="confirm-group" style="display:none;">
        <label for="confirm">Confirm Password</label>
        <input type="password" id="confirm" placeholder="Confirm your password">
        <span class="toggle-password" data-target="confirm">Show</span>
      </div>
      <button type="submit" class="btn" id="submit-btn">Login</button>
    </form>
    <div class="extra-links fade show" id="extra-links">
      <p id="toggle-text">Don‚Äôt have an account? <a id="toggle-link">Sign Up</a></p>
      <p><a id="forgot-link">Forgot Password?</a></p>
    </div>
    <div id="message"></div>
  </div>

  <!-- Forgot Password Modal -->
  <div id="forgot-modal" class="modal">
    <div class="modal-content">
      <h3>Reset Password</h3>
      <p>Enter your email to receive a reset link:</p>
      <input type="email" id="reset-email" placeholder="Enter your email" required>
      <button id="reset-btn" class="btn">Send Reset Link</button>
      <button id="close-btn" class="btn secondary">Cancel</button>
      <p id="reset-message"></p>
    </div>
  </div>

<!-- add EmailJS SDK (put above your module script) -->
<!-- EmailJS v4 SDK -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<script type="module">
  // --- Firebase imports ---
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, 
    sendPasswordResetEmail 
  } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js";

  // --- Firebase Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyB7PKVUrQcL-pEeOnn9XU9D3tgK90WkSU8",
    authDomain: "travelbook-64c34.firebaseapp.com",
    projectId: "travelbook-64c34",
    storageBucket: "travelbook-64c34.firebasestorage.app",
    messagingSenderId: "964725351972",
    appId: "1:964725351972:web:788b5e8361333723fa5ab1"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);

  // --- Initialize EmailJS ---
  emailjs.init({
    publicKey: "kOgrbxu1e0qiwzkHC"   // üîπ replace with your own PUBLIC key
  });

  // --- DOM elements ---
  const form = document.getElementById("auth-form");
  const formTitle = document.getElementById("form-title");
  const submitBtn = document.getElementById("submit-btn");
  const toggleText = document.getElementById("toggle-text");
  const toggleLink = document.getElementById("toggle-link");
  const forgotLink = document.getElementById("forgot-link");
  const message = document.getElementById("message");
  const confirmGroup = document.getElementById("confirm-group");
  const confirmInput = document.getElementById("confirm");

  // OTP UI elements
  let otpGroup, otpInput, sendCodeBtn, verifyBtn;
  let isLogin = true;
  let pendingOTP = null;
  let otpExpiry = null;

  // --- Helper: Generate OTP ---
  function genCode() {
    return Math.floor(100000 + Math.random() * 900000).toString();
  }

  // --- Ensure OTP UI ---
  function ensureOtpUI() {
    if (otpGroup) return;
    otpGroup = document.createElement("div");
    otpGroup.className = "input-group";
    otpGroup.innerHTML = `
      <label for="otp">Verification Code</label>
      <input type="text" id="otp" placeholder="Enter 6-digit code" maxlength="6" />
      <div style="display:flex; gap:8px; margin-top:8px;">
        <button type="button" id="send-code-btn" class="btn secondary">Send Code</button>
        <button type="button" id="verify-code-btn" class="btn">Verify</button>
      </div>
      <div id="otp-msg" style="margin-top:8px; color:#f87171; min-height:18px;"></div>
    `;
    const submitButton = document.getElementById("submit-btn");
    submitButton.parentNode.insertBefore(otpGroup, submitButton);
    otpInput = document.getElementById("otp");
    sendCodeBtn = document.getElementById("send-code-btn");
    verifyBtn = document.getElementById("verify-code-btn");

    sendCodeBtn.addEventListener("click", sendOtpEmail);
    verifyBtn.addEventListener("click", verifyOtpFromInput);
  }

  // --- Send OTP via EmailJS ---
  async function sendOtpEmail() {
    const email = document.getElementById("email").value;
    if (!email) return showOtpMsg("Please enter an email first.", true);

    const code = genCode();
    pendingOTP = code;
    otpExpiry = Date.now() + 5 * 60 * 1000;
    sessionStorage.setItem("signup_pending_otp", pendingOTP);
    sessionStorage.setItem("signup_pending_otp_expiry", otpExpiry.toString());

    const serviceID = "service_1vbw5mr";   // üîπ replace with your EmailJS service ID
    const templateID = "template_tknxjvp"; // üîπ replace with your template ID

    const templateParams = {
      to_email: email,
      code: code
    };

    try {
      sendCodeBtn.disabled = true;
      sendCodeBtn.textContent = "Sending...";
      await emailjs.send(serviceID, templateID, templateParams);
      showOtpMsg("Verification code sent ‚Äî check your email.", false);
      setTimeout(() => {
        sendCodeBtn.disabled = false;
        sendCodeBtn.textContent = "Send Code";
      }, 30000);
    } catch (err) {
      console.error("EmailJS error:", err);
      showOtpMsg("Failed to send code. Try again later.", true);
      sendCodeBtn.disabled = false;
      sendCodeBtn.textContent = "Send Code";
    }
  }

  function showOtpMsg(text, isError) {
    const el = document.getElementById("otp-msg");
    if (!el) return;
    el.style.color = isError ? "#f87171" : "#4ade80";
    el.textContent = text;
  }

  function verifyOtpFromInput() {
    const input = (document.getElementById("otp") || {}).value;
    const stored = sessionStorage.getItem("signup_pending_otp");
    const expiry = Number(sessionStorage.getItem("signup_pending_otp_expiry") || "0");
    if (!stored) return showOtpMsg("No code requested. Click Send Code first.", true);
    if (Date.now() > expiry) return showOtpMsg("Code expired. Request a new one.", true);
    if (input === stored) {
      showOtpMsg("Code verified ‚Äî you may complete sign up.", false);
      sessionStorage.setItem("signup_verified", "1");
    } else {
      showOtpMsg("Incorrect code. Try again.", true);
    }
  }

  // --- Switch modes ---
  function smoothSwitch(newTitle, newBtn, newToggle, showConfirm) {
    [formTitle, form, document.getElementById("extra-links")].forEach(el => el.classList.remove("show"));
    setTimeout(() => {
      formTitle.textContent = newTitle;
      submitBtn.textContent = newBtn;
      toggleText.innerHTML = newToggle;
      document.querySelector("#toggle-link").addEventListener("click", toggleMode);
      confirmGroup.style.display = showConfirm ? "block" : "none";
      form.reset();
      message.textContent = "";
      if (!isLogin) {
        ensureOtpUI();
        sessionStorage.removeItem("signup_pending_otp");
        sessionStorage.removeItem("signup_verified");
      } else {
        if (otpGroup) otpGroup.remove();
        otpGroup = null;
      }
      [formTitle, form, document.getElementById("extra-links")].forEach(el => el.classList.add("show"));
    }, 400);
  }

  function toggleMode() {
    isLogin = !isLogin;
    if (isLogin) {
      smoothSwitch("Login", "Login", `Don‚Äôt have an account? <a id="toggle-link">Sign Up</a>`, false);
    } else {
      smoothSwitch("Sign Up", "Sign Up", `Already have an account? <a id="toggle-link">Login</a>`, true);
    }
  }

  toggleLink.addEventListener("click", toggleMode);

  // --- Submit form ---
  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const email = document.getElementById("email").value.trim();
    const password = document.getElementById("password").value;

    try {
      if (isLogin) {
        await signInWithEmailAndPassword(auth, email, password);
        message.style.color = "#4ade80";
        message.textContent = "Login successful!";
        setTimeout(() => { window.location.href = "Userpage.html"; }, 1000);
      } else {
        if (password !== confirmInput.value) {
          message.style.color = "#f87171";
          message.textContent = "‚ö†Ô∏è Passwords do not match.";
          return;
        }
        const verified = sessionStorage.getItem("signup_verified");
        const stored = sessionStorage.getItem("signup_pending_otp");
        const expiry = Number(sessionStorage.getItem("signup_pending_otp_expiry") || "0");
        if (!stored || !verified || Date.now() > expiry) {
          message.style.color = "#f87171";
          message.textContent = "‚ö†Ô∏è Please verify the code sent to your email.";
          return;
        }
        await createUserWithEmailAndPassword(auth, email, password);
        message.style.color = "#4ade80";
        message.textContent = "üéâ Account created successfully!";
        sessionStorage.removeItem("signup_pending_otp");
        sessionStorage.removeItem("signup_verified");
        setTimeout(() => toggleMode(), 1200);
      }
    } catch(err) {
      message.style.color = "#f87171";
      message.textContent = "‚ö†Ô∏è " + err.message;
    }
  });

  // --- Forgot password ---
  const forgotModal = document.getElementById("forgot-modal");
  const resetBtn = document.getElementById("reset-btn");
  const closeBtn = document.getElementById("close-btn");
  const resetEmail = document.getElementById("reset-email");
  const resetMessage = document.getElementById("reset-message");

  forgotLink.addEventListener("click", () => {
    forgotModal.style.display = "flex";
    resetMessage.textContent = "";
    resetEmail.value = "";
  });

  closeBtn.addEventListener("click", () => forgotModal.style.display = "none");

  resetBtn.addEventListener("click", async () => {
    const email = resetEmail.value;
    if (!email) return resetMessage.textContent = "‚ö†Ô∏è Please enter your email.";
    try {
      await sendPasswordResetEmail(auth, email);
      resetMessage.style.color = "#4ade80";
      resetMessage.textContent = "Reset email sent!";
    } catch(err) {
      resetMessage.style.color = "#f87171";
      resetMessage.textContent = "‚ö†Ô∏è " + err.message;
    }
  });

  // --- Show/Hide password ---
  document.querySelectorAll(".toggle-password").forEach(btn => {
    btn.addEventListener("click", () => {
      const target = document.getElementById(btn.dataset.target);
      if (target.type === "password") {
        target.type = "text";
        btn.textContent = "Hide";
      } else {
        target.type = "password";
        btn.textContent = "Show";
      }
    });
  });
</script>


</body>
</html>
